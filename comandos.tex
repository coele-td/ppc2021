%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Comandos customizados
%
%   Este arquivo lista comandos customizados para utilizar no PCC.
%   Muitos comandos utilizam diretamente o arquivo Dados/unidadesCurriculares.csv
% 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Escreve o nome por extenso da UTFPR:
\newcommand{\utf}{Universidade Tecnológica Federal do Paraná}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Coloca um checkmark caso a disciplina seja extensionista:
\newcommand{\ifext}[2]{\ifcsvstrcmp{\ext}{0}{#1}{#2}} % Utilizado nas tabelas das unidades curriculares dos períodos

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Escreve a área da optativa
\newcommand{\optativa}[1]{
    \ifnum #1 = 21
        Controle e automação\fi
    \ifnum #1 = 22
        Trilha de Computação\fi
    \ifnum #1 = 23
        Trilha de Eletrônica\fi
    \ifnum #1 = 24
        Trilha de Eletrotécnica\fi
    \ifnum #1 = 31
        Optativas de Humanidades\fi
    \ifnum #1 = 32
        Metodologia de Ensino Inovador da UTFPR\fi
    \ifnum #1 = 33
        Não definido\fi
    \ifnum #1 = 41
        Optativas de Ciências do Ambiente\fi
}
% Este comando define a macro \optativa, que aceita um argumento numérico e retorna uma string representando a categoria de disciplina correspondente.
% Os números fornecidos como argumento representam períodos de disciplinas na coluna "período" da planilha unidadesCurriculares.csv localizada na pasta Dados.
% Quando o período é maior que 10, o valor do período indica uma categoria específica de disciplina, conforme mostrado neste comando.
% 
% Neste código, cada condição é verificada separadamente usando o comando \ifnum, seguido pelo valor correspondente da categoria de disciplina e, em seguida, fechado com \fi.
% 
% Para adicionar mais categorias, siga os passos abaixo:
% 
% 1. Adicione uma nova linha após as categorias existentes, usando o mesmo formato.
% 2. Substitua o número (#1) no \ifnum pelo valor numérico correspondente à nova categoria.
% 3. Substitua o texto entre chaves {} pelo nome da nova categoria de disciplina e adicione \fi no final da linha.
% 
% Por exemplo, para adicionar uma categoria "Exemplo" com o valor numérico 42, adicione a seguinte linha:
% \ifnum #1 = 42 Exemplo\fi
%
% Certifique-se de que os valores numéricos usados sejam únicos e não se sobreponham aos valores existentes.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Escreve o período por extenso
\newcommand{\pernum}[1]{% \pernum{<número do período de 1 à 10>}
    \ifthenelse{#1 < 1 \OR #1 > 10}{%
        !Erro!% Mensagem de erro para valores fora do intervalo de 1 a 10
    }{%
        \ifnum #1 = 1
            Primeiro\fi
        \ifnum #1 = 2
            Segundo\fi
        \ifnum #1 = 3
            Terceiro\fi
        \ifnum #1 = 4
            Quarto\fi
        \ifnum #1 = 5
            Quinto\fi
        \ifnum #1 = 6
            Sexto\fi
        \ifnum #1 = 7
            Sétimo\fi
        \ifnum #1 = 8
            Oitavo\fi
        \ifnum #1 = 9
            Nono\fi
        \ifnum #1 = 10
            Décimo\fi
    }
}
% Este comando define a macro \pernum, que aceita um argumento numérico e retorna o período por extenso correspondente (de 1 a 10).
% Utiliza-se o pacote ifthen para verificar se o valor fornecido está fora do intervalo de 1 a 10 e exibir uma mensagem de erro, se necessário.
% Quando o valor está dentro do intervalo válido, o comando verifica cada condição separadamente usando o comando \ifnum, seguido pelo valor correspondente do período por extenso e, em seguida, fechado com \fi.
%
% Para utilizar o comando \pernum, insira \pernum{<número do período de 1 à 10>}
%
% Exemplo de uso:
% \pernum{3} retorna "Terceiro"
%
% Se o valor fornecido estiver fora do intervalo de 1 a 10, a mensagem "!Erro!" será exibida.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Imprime a planilha do período
\newcommand{\tabelaPeriodo}[2]{% \tabelaPeriodo{<número do período de 1 à 10>}{<arquivo csv>}
    
    \begin{tabularx}{\textwidth}{>{\centering\arraybackslash}X >{\centering\arraybackslash}X c||ccc}\toprule

        % Primeira linha:
    	\multicolumn{3}{c||}{\bfseries \pernum{#1} Período}	&	\multicolumn{3}{c}{\bfseries Carga horária (h)}\\
    	\midrule

        % Variáveis da tabela em negrito:
    	\bfseries Unidade Curricular & \bfseries Área do Conhecimento	& \bfseries Extensionista & \bfseries AT$^1$ & \bfseries AP$^2$& \bfseries Total$^3$\\
    	\midrule
    
        \csvreader[ head to column names,
                    separator=pipe,
                    %before first line=\\\rowcolor{gray!10},                 
                    late after line=\csvifoddrow{\\}{\\\rowcolor{gray!10}}, 
                    filter test=\ifnumequal{\periodo}{#1}]%
                    {#2}{}%
    	{\hyperref[qua:uc\codigo]{\nome}	& \areaConhecimento	& \ifext{-}{\checkmark} & \chTeorica	& \chPratica	& \chtotal }%

    	\midrule

        \rowcolor{white}\multicolumn{3}{r}{\bfseries Totais:} & \bfseries \the\value{horasAT#1} & \bfseries \the\value{horasAP#1}  & \bfseries \the\value{horasT#1}\\
        
        % \midrule
        
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária presencial total:} & \bfseries \the\value{horasP#1}\\
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária não-presencial total:} & \bfseries \the\value{horasANP#1}\\
    	% \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária total:} & \bfseries \the\value{horasP#1}\\

    	\bottomrule  

    	\multicolumn{6}{l}{$^1$ \tiny AT - Atividades Teóricas}\\
    	\multicolumn{6}{l}{$^2$ \tiny AP - Atividades Práticas}\\
        \multicolumn{6}{l}{$^3$\tiny Total = AT + AP}\\	
    \end{tabularx}    
}	

% Imprime a planilha de trilha ou Optativa
\newcommand{\tabelaTrilha}[2]{% \tabelaTrilha{<número da Optativa de 21 à 49>}{<arquivo csv>}
    
    \begin{tabularx}{\textwidth}{>{\centering\arraybackslash}X >{\centering\arraybackslash}X c||ccc}\toprule

        % Primeira linha:
    	\multicolumn{3}{c||}{\bfseries \optativa{#1}}	&	\multicolumn{3}{c}{\bfseries Carga horária (h)}\\
    	\midrule

        % Variáveis da tabela em negrito:
    	\bfseries Unidade Curricular & \bfseries Área do Conhecimento	& \bfseries Extensionista & \bfseries AT$^1$ & \bfseries AP$^2$& \bfseries Total$^3$\\
    	\midrule
    
        \csvreader[ head to column names,
                    separator=pipe,
                    %before first line=\\\rowcolor{gray!10},                 
                    late after line=\csvifoddrow{\\}{\\\rowcolor{gray!10}}, 
                    filter test=\ifnumequal{\periodo}{#1}]%
                    {#2}{}%
    	{\hyperref[qua:uc\codigo]{\nome}	& \areaConhecimento	& \ifext{-}{\checkmark} & \chTeorica	& \chPratica	& \chtotal }%

    	\midrule

        \rowcolor{white}\multicolumn{3}{r}{\bfseries Totais:} & \bfseries \the\value{horasAT#1} & \bfseries \the\value{horasANP#1} & \bfseries \the\value{horasT#1}\\
        
        % \midrule
        
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária presencial total:} & \bfseries \the\value{horasP#1}\\
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária não-presencial total:} & \bfseries \the\value{horasANP#1}\\
    	% \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária total:} & \bfseries \the\value{horasP#1}\\

    	\bottomrule  

    	\multicolumn{6}{l}{$^1$ \tiny AT - Atividades Teóricas}\\
    	\multicolumn{6}{l}{$^2$ \tiny AP - Atividades Práticas}\\
        \multicolumn{6}{l}{$^3$ \tiny Total = AT + AP}\\	
    \end{tabularx}  
}  

% Imprime a planilha Optativas de humanas
\newcommand{\tabelaOptHum}[2]{% \tabelaOptHum{<número da Optativa de 21 à 49>}{<arquivo csv>}
    
    \begin{tabularx}{\textwidth}{>{\centering\arraybackslash}X >{\centering\arraybackslash}X c||ccc}\toprule

        % Primeira linha:
    	\multicolumn{3}{c||}{\bfseries \optativa{#1}}	&	\multicolumn{3}{c}{\bfseries Carga horária (h)}\\
    	\midrule

        % Variáveis da tabela em negrito:
    	\bfseries Unidade Curricular & \bfseries Área & \bfseries Extensionista & \bfseries AT$^1$ & \bfseries AP$^2$& \bfseries Total$^3$\\
    	\midrule
    
        \csvreader[ head to column names,
                    separator=pipe,
                    %before first line=\\\rowcolor{gray!10},                 
                    late after line=\csvifoddrow{\\}{\\\rowcolor{gray!10}}, 
                    filter test=\ifnumequal{\periodo}{#1}]%
                    {#2}{}%
    	{\hyperref[qua:uc\codigo]{\nome}	& \areaHumanas	& \ifext{-}{\checkmark} & \chTeorica	& \chPratica	& \chtotal }%

    	\midrule

        \rowcolor{white}\multicolumn{3}{r}{\bfseries Totais:} & \bfseries \the\value{horasAT#1} & \bfseries \the\value{horasAP#1} & \bfseries \the\value{horasT#1}\\
        
        % \midrule
        
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária presencial total:} & \bfseries \the\value{horasP#1}\\
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária não-presencial total:} & \bfseries \the\value{horasANP#1}\\
    	% \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária total:} & \bfseries \the\value{horasP#1}\\

    	\bottomrule  

    	\multicolumn{6}{l}{$^1$ \tiny AT - Atividades Teóricas}\\
    	\multicolumn{6}{l}{$^2$ \tiny AP - Atividades Práticas}\\    	
        \multicolumn{6}{l}{$^3$ \tiny Total = AT + AP}\\
    \end{tabularx}  
}  

% Imprime a planilha do ciclo de humanidades humanas
\newcommand{\tabelaHum}[1]{% \tabelaHum{<arquivo csv>}
    
    \begin{tabularx}{\textwidth}{>{\centering\arraybackslash}X >{\centering\arraybackslash}X c||ccc}\toprule

        % Primeira linha:
    	\multicolumn{3}{c||}{\bfseries Unidade Curricular}	&	\multicolumn{3}{c}{\bfseries Carga horária (h)}\\
    	\midrule

        % Variáveis da tabela em negrito:
    	\bfseries Unidade Curricular & \bfseries Área & \bfseries Extensionista & \bfseries AT$^1$ & \bfseries AP$^2$& \bfseries Total$^3$\\
    	\midrule
    
        \csvreader[ head to column names,
                    separator=pipe,
                    %before first line=\\\rowcolor{gray!10},                 
                    late after line=\csvifoddrow{\\}{\\\rowcolor{gray!10}}, 
                    filter expr={test{\ifnumgreater{\humanidades}{0}} and test{\ifnumcomp{\periodo}{<}{12}} }]%
                    {#1}{}%
    	{\hyperref[qua:uc\codigo]{\nome}	& \areaHumanas	& \ifext{-}{\checkmark} & \chTeorica	& \chPratica	& \chtotal }%

    	\midrule

        \rowcolor{white}\multicolumn{3}{r}{\bfseries Totais:} & \bfseries \the\value{horasH:AT} & \bfseries \the\value{horasH:AP} & \bfseries \the\value{horasH:T}\\
        
        % \midrule
        
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária presencial total:} & \bfseries \the\value{horasP#1}\\
        % \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária não-presencial total:} & \bfseries \the\value{horasANP#1}\\
    	% \rowcolor{white}\multicolumn{6}{r}{\bfseries Carga horária total:} & \bfseries \the\value{horasP#1}\\

    	\bottomrule  

    	\multicolumn{6}{l}{$^1$ \tiny AT - Atividades Teóricas}\\
    	\multicolumn{6}{l}{$^2$ \tiny AP - Atividades Práticas}\\
        \multicolumn{6}{l}{$^3$ \tiny Total = AT + AP}\\	
    \end{tabularx}  
}  


% Imprime as ementas de um período
\newcommand{\imprimeEmentas}[2]{% % \imprimeEmentas{<número do período de 1 à 10>}{<arquivo csv>}
    \csvreader[head to column names, separator=pipe, filter test=\ifnumequal{\periodo}{#1}]{#2}{}{%
	
		\begin{quadro}[!ht]
            \footnotesize
			\centering
			\caption{Dados estruturais da unidade curricular de \nome}
			\label{qua:uc\codigo}
			\begin{tabularx}{\textwidth}{|c|>{\centering}m{4cm}|c|c|}
            %\begin{tabularx}{\textwidth}{|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|}
				\hline
				\multicolumn{4}{|>{\centering}X|}{\cellcolor[HTML]{656565}\bfseries \color{white} \vspace{5pt} \nome \vspace{5pt}}\\ \hline\hline				
				\cellcolor[HTML]{C0C0C0}Período                 & \hyperref[tab:per\periodo]{\pernum{\periodo}}			    & \cellcolor[HTML]{C0C0C0}Código			& \codigo		    \\ \hline
				\cellcolor[HTML]{C0C0C0}Referência na matriz    & \referencia		                                        & \cellcolor[HTML]{C0C0C0}Pré-requisito		& \prereq		    \\ \hline
				\cellcolor[HTML]{C0C0C0}Área do Conhecimento    & \areaConhecimento	                                        & \cellcolor[HTML]{C0C0C0}Modalidade 		& \modalidade	    \\ \hline				
				\cellcolor[HTML]{C0C0C0}Extensionista 			& \ifext{não}{sim}                                          & \cellcolor[HTML]{C0C0C0}Idioma        	& \idioma           \\ \hline\hline
				\multirow{2}{*}{\bfseries Carga Horária}        & \multicolumn{2}{c|}{\bfseries Atividade Teórica - AT}                                                  & \chTeorica{} h    \\ \cline{2-4}
				                                                & \multicolumn{2}{c|}{\bfseries Atividade Prática - AP}                                                  & \chPratica{} h    \\ \cline{2-4} \hline
				                                                

				\multicolumn{4}{|c|}{\cellcolor[HTML]{C0C0C0}\textbf{Carga horária total: \chtotal{} h}}  																		            \\ \hline\hline
				\multicolumn{4}{|>{\centering}X|}{\bfseries \vspace{5pt} Ementa \vspace{5pt}}                                                                       			            \\ \hline
				\multicolumn{4}{|>{\hsize=\hsize}X|}{\ementa}                                                                                                                               \\ \hline
			\end{tabularx}
			\fonte{Autoria própria}
		\end{quadro}
	
	}
}

% Imprime as ementas de optativas
\newcommand{\imprimeEmentasOpt}[2]{% % \imprimeEmentasOpt{<número do período de 21 à 49>}{<arquivo csv>}
    \csvreader[head to column names, separator=pipe, filter test=\ifnumequal{\periodo}{#1}]{#2}{}{%
	
		\begin{quadro}[!ht]
            \footnotesize
			\centering
			\caption{Dados estruturais da unidade curricular optativa de \nome}
			\label{qua:uc\codigo}
			\begin{tabularx}{\textwidth}{|c|>{\centering}m{4cm}|c|c|}
            %\begin{tabularx}{\textwidth}{|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|}
				\hline
				\multicolumn{4}{|>{\centering}X|}{\cellcolor[HTML]{656565}\bfseries \color{white} \vspace{5pt} \nome \vspace{5pt}}\\ \hline\hline				
				\cellcolor[HTML]{C0C0C0}Tipo de Optativa        & \optativa{\periodo}			        & \cellcolor[HTML]{C0C0C0}Código			& \codigo		    \\ \hline
				\cellcolor[HTML]{C0C0C0}Referência na matriz    & N/A		                                        & \cellcolor[HTML]{C0C0C0}Pré-requisito		& \prereq		    \\ \hline
				\cellcolor[HTML]{C0C0C0}Área do Conhecimento    & \areaConhecimento	                                        & \cellcolor[HTML]{C0C0C0}Modalidade 		& \modalidade	    \\ \hline				
				\cellcolor[HTML]{C0C0C0}Extensionista 			& \ifext{não}{sim}                                          & \cellcolor[HTML]{C0C0C0}Idioma        	& \idioma           \\ \hline\hline
				\multirow{2}{*}{\bfseries Carga Horária}        & \multicolumn{2}{c|}{\bfseries Atividade Teórica - AT}                                                  & \chTeorica{} h    \\ \cline{2-4}
				                                                & \multicolumn{2}{c|}{\bfseries Atividade Prática - AP}                                                  & \chPratica{} h    \\ \cline{2-4}\hline
				                                                

				\multicolumn{4}{|c|}{\cellcolor[HTML]{C0C0C0}\textbf{Carga horária total: \chtotal{} h}}  																		            \\ \hline\hline
				\multicolumn{4}{|>{\centering}X|}{\bfseries \vspace{5pt} Ementa \vspace{5pt}}                                                                       			            \\ \hline
				\multicolumn{4}{|>{\hsize=\hsize}X|}{\ementa}                                                                                                                               \\ \hline
			\end{tabularx}
			\fonte{Autoria própria}
		\end{quadro}
	
	}
}

% Imprime as ementas de optativas de Humanidades
\newcommand{\imprimeEmentasHum}[2]{% % \imprimeEmentasHum{<número do período de 21 à 49>}{<arquivo csv>}
    \csvreader[head to column names, separator=pipe, filter test=\ifnumequal{\periodo}{#1}]{#2}{}{%
	
		\begin{quadro}[!ht]
            \footnotesize
			\centering
			\caption{Dados estruturais da unidade curricular optativa de \nome}
			\label{qua:uc\codigo}
			\begin{tabularx}{\textwidth}{|c|>{\centering}m{4cm}|c|c|}
            %\begin{tabularx}{\textwidth}{|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|>{\centering\arraybackslash}X|}
				\hline
				\multicolumn{4}{|>{\centering}X|}{\cellcolor[HTML]{656565}\bfseries \color{white} \vspace{5pt} \nome \vspace{5pt}}\\ \hline\hline				
				\cellcolor[HTML]{C0C0C0}Tipo de Optativa        & \optativa{\periodo}			        & \cellcolor[HTML]{C0C0C0}Código			& \codigo		    \\ \hline
				\cellcolor[HTML]{C0C0C0}Referência na matriz    & N/A		                                        & \cellcolor[HTML]{C0C0C0}Pré-requisito		& \prereq		    \\ \hline
				\cellcolor[HTML]{C0C0C0}Área do Conhecimento    & \areaHumanas	                                            & \cellcolor[HTML]{C0C0C0}Modalidade 		& \modalidade	    \\ \hline				
				\cellcolor[HTML]{C0C0C0}Extensionista 			& \ifext{não}{sim}                                          & \cellcolor[HTML]{C0C0C0}Idioma        	& \idioma           \\ \hline\hline
				\multirow{3}{*}{\bfseries Carga Horária}        & \multicolumn{2}{c|}{\bfseries Atividade Teórica - AT}                                                  & \chTeorica{} h    \\ \cline{2-4}
				                                                & \multicolumn{2}{c|}{\bfseries Atividade Prática - AP}                                                  & \chPratica{} h    \\ \cline{2-4}\hline
				                                                

				\multicolumn{4}{|c|}{\cellcolor[HTML]{C0C0C0}\textbf{Carga horária total: \chtotal{} h}}  																		            \\ \hline\hline
				\multicolumn{4}{|>{\centering}X|}{\bfseries \vspace{5pt} Ementa \vspace{5pt}}                                                                       			            \\ \hline
				\multicolumn{4}{|>{\hsize=\hsize}X|}{\ementa}                                                                                                                               \\ \hline
			\end{tabularx}
			\fonte{Autoria própria}
		\end{quadro}
	
	}
}

%Lista as disciplinas de um período em texto corrido, referenciando o quadro das características estruturais
% \newcommand{\tiraespaco}{)}
% \newcommand{\listaUC}[2]{\!\!\!
%     \csvreader[ head to column names, 
%                 separator=pipe,                
%                 late after line={{,}\space},
%                 late after first line={{,}\space},
%                 late after last line={},
%                 filter test=\ifnumequal{\periodo}{#1}]{#2}{}{%
%         \nome\space(\autoref{qua:uc\codigo}\tiraespaco
%     }\!\!
% }

\newcounter{totalrows}
\newcounter{currentrow}
\newcommand{\listaUC}[2]{%
    \setcounter{totalrows}{0}%
    \setcounter{currentrow}{0}%
    \csvreader[ head to column names,%
                separator=pipe,%
                filter test=\ifnumequal{\periodo}{#1}]{#2}{}{\stepcounter{totalrows}}%
    \csvreader[ head to column names,%
                separator=pipe,%
                late after line={\stepcounter{currentrow}\ifnumequal{\the\value{currentrow}}{\the\value{totalrows}-1}{ e\space}{,\space}},%
                late after last line={},%
                filter test=\ifnumequal{\periodo}{#1}]{#2}{}{\nome\space(\autoref{qua:uc\codigo})}%
}%




%\newcommand{\tiraespaco}{)}
% \newcommand{\listaUC}[2]{
    
%     \csvreader[ head to column names,
%                 before first line=\autoref{qua:uc\codigo},
%                 after line=\space{à} \autoref{qua:uc\codigo},
%                 separator=pipe, 
%                 filter test=\ifnumequal{\periodo}{#1}]{#2}{}{}
    
% }

%Retorna a percentagem do segundo argumento (#2) em relação ao terceiro (#3), o primeiro parâmetro (#1) é opcional e representa as casas decimais (padrão = 2)
\newcommand{\percentagem}[3][2]{\FPset\tempval{0}\FPeval{\tempval}{round(100*#2/#3,#1)}$\tempval$\%}


\newcommand{\dadoCHT}[1]{
    \csvreader[ 
        head to column names, 
        separator=pipe                
    ]{Dados/unidadesCurriculares.csv}{}{%
        \ifthenelse{\equal{\referencia}{#1}}
            {\chtotal}  % True
            {{}}%         % False
        %\chtotal #1,
    }%
}%